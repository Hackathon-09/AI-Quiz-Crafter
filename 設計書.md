# **AI問題生成学習システム 基本設計書（最終目標版）**

## **1\. はじめに**

### **1.1. 本書の目的**

本書は、「AI問題生成学習システム 要件定義書」に記載された全ての機能（Won't-Have項目を含む）を実現するための、システムの技術的な仕様、アーキテクチャ、および実装方針を定義する。本書は、ハッカソンでのMVP開発から最終的な製品リリースまでの技術的な道標となる。

### **1.2. 対象読者**

本システムの開発に携わるプロジェクトマネージャー、ソフトウェアエンジニア、および品質保証担当者。

## **2\. システム構成**

### **2.1. 全体構成図**

最終的な製品版では、リアルタイム共有機能とオフライン対応を実現するため、PWA（Progressive Web App）アーキテクチャとリアルタイムAPIを追加する。

graph TD  
    subgraph "ユーザー (ブラウザ/PWA)"  
        A\[フロントエンド (React/Next.js)\]  
        subgraph "オフライン機能"  
            A \-- データ永続化/同期 \--\> SW\[Service Worker\]  
            SW \-- ローカル保存 \--\> LDB\[IndexedDB/Local Storage\]  
        end  
    end

    subgraph "AWS Cloud"  
        B\[API Gateway (REST)\]  
        AS\[AWS AppSync (GraphQL)\]  
        C\[AWS Lambda\]  
        D\[Amazon Bedrock (AIモデル)\]  
        E\[Amazon DynamoDB (データベース)\]  
        F\[Amazon S3 (ファイルストレージ)\]  
        G\[Amazon Cognito (ユーザー認証)\]  
        H\[Amazon Textract (OCR)\]  
        I\[Notion API (外部)\]  
    end

    A \-- (1) 認証リクエスト \--\> G  
    A \-- (2a) 通常APIリクエスト \--\> B  
    A \-- (2b) リアルタイムAPIリクエスト \--\> AS

    B \-- トリガー \--\> C  
    AS \-- データソース \--\> C  
    AS \-- データソース \--\> E

    subgraph "バックエンド処理 (Lambda)"  
        C \-- (4a) ファイルアップロード/ダウンロード \--\> F  
        C \-- (4b) データ読み書き \--\> E  
        C \-- (4c) AI処理 (問題生成・対話) \--\> D  
        C \-- (4d) OCR処理 \--\> H  
        C \-- (4e) Notionページ取得 \--\> I  
    end

### **2.2. 技術スタック（技術選定）**

最終目標を達成するため、以下の技術を選定する。

| 領域 | 技術・サービス名 | 選定理由 |
| :---- | :---- | :---- |
| **フロントエンド** | React (Next.js), **PWA (Service Worker)** | モダンなUIに加え、PWA化によりオフライン対応とネイティブアプリに近い体験を提供。 |
| **バックエンド** | AWS Lambda (Python) | サーバーレスでスケーラブル。AI/MLライブラリとの親和性が高い。 |
| **API** | Amazon API Gateway (REST), **AWS AppSync (GraphQL)** | 通常のCRUD操作はRESTで、\*\*リアルタイムのデータ同期や共有機能はGraphQL (AppSync)\*\*で効率的に実装。 |
| **データベース** | Amazon DynamoDB | 高速・スケーラブルなNoSQL。柔軟なデータ構造とAppSyncとの親和性が高い。 |
| **AIモデル** | Amazon Bedrock | 高性能な生成AIモデルをAPI経由で利用可能。AI関連機能の心臓部。 |
| **ユーザー認証** | Amazon Cognito | 堅牢な認証・認可機能を提供。SNSログインにも対応。 |
| **ファイルストレージ** | Amazon S3 | ファイル（PDF, TXT, 画像）を安全かつ安価に保管する業界標準のストレージ。 |
| **OCR** | Amazon Textract | (F-16対応) 手書き文字を含む画像から高精度にテキストを抽出。 |

## **3\. 画面設計**

### **3.1. 画面遷移図**

ユーザーの主要な操作フローに基づき、画面遷移を以下のように定義する。

graph TD  
    subgraph "認証エリア"  
        LP\[ランディングページ\] \--\> Login\[ログイン/新規登録画面\]  
    end

    Login \--\> Main\[メイン画面（ダッシュボード）\]

    subgraph "メイン機能エリア"  
        Main \-- ノート入力 & 設定 \--\> Main  
        Main \-- クイズ生成ボタン \--\> Quiz\[クイズ実行画面\]  
        Main \-- 履歴・統計表示 \--\> Main  
        Main \-- AI教師チャット \--\> Main  
        Main \-- ノート共有設定 \--\> Share\[共有管理モーダル\]  
    end

    subgraph "クイズフロー"  
        Quiz \-- 解答 \--\> Result\[結果・解説画面\]  
        Result \-- 次の問題へ \--\> Quiz  
        Result \-- クイズ終了 \--\> Main  
    end

    subgraph "その他"  
        Main \-- 設定アイコン \--\> Settings\[ユーザー設定画面\]  
        Settings \-- 変更保存/戻る \--\> Main  
        Main \-- ログアウト \--\> LP  
    end

### **3.2. 主要画面ワイヤーフレーム（詳細）**

* **ログイン/新規登録画面**  
  * **目的**: ユーザー認証を行う。  
  * **コンポーネント**:  
    * システムロゴ  
    * 「ログイン」「新規登録」の切り替えタブ  
    * メールアドレス入力フィールド  
    * パスワード入力フィールド  
    * 「ログイン」または「登録」ボタン  
    * Google / Apple等のSNSログインボタン  
    * パスワードリセットへのリンク  
* **メイン画面（ダッシュボード）**  
  * **目的**: アプリケーションのハブとして、ノート入力、クイズ設定、AI教師機能、学習状況の確認を行う。  
  * **レイアウト**: 3カラムレイアウトを基本とする。  
  * **左カラム（ノート管理）**:  
    * **入力方法選択タブ**: 「テキスト」「ファイル」「Notion」「画像(OCR)」  
    * 選択したタブに応じた入力UI（テキストエリア、ファイルアップロードボタン等）  
    * 過去に作成したノートのリスト表示と選択機能  
    * 選択中ノートの「共有」ボタン  
  * **中央カラム（クイズ設定 & 実行）**:  
    * **クイズ設定パネル**:  
      * 問題数指定（ドロップダウン or スライダー）  
      * 問題形式選択（チェックボックス：選択式、記述式、正誤判定）  
      * 難易度選択（ラジオボタン：基礎、標準、応用）  
    * **「クイズを生成する」ボタン**: このボタンがメインのアクションとなる。  
    * **学習統計エリア**:  
      * 総解答数、全体の正答率  
      * タグ別正答率のグラフ（苦手分野の可視化）  
      * 「復習モードを開始」ボタン（間違えた問題のみ）  
  * **右カラム（AI教師）**:  
    * チャット形式のUI  
    * メッセージ入力ボックスと送信ボタン  
    * 過去の対話履歴表示エリア  
* **クイズ実行画面**  
  * **目的**: 生成されたクイズに集中して解答する。  
  * **コンポーネント**:  
    * ヘッダー: 「問題 3 / 10」のような進捗表示  
    * 問題文表示エリア  
    * 問題形式に応じた解答UI（例：4つの選択肢ボタン、テキスト入力フィールド）  
    * 「解答を確定する」ボタン  
* **結果・解説画面**  
  * **目的**: 解答の正誤を確認し、解説を通じて深い理解を得る。  
  * **レイアウト**: 解答後にモーダルウィンドウまたは画面全体で表示。  
  * **コンポーネント**:  
    * 「正解！」または「不正解…」の大きなインジケータ  
    * **正解**: ユーザーが選んだ選択肢と正解の選択肢  
    * **AIによる解説**: なぜその答えになるかの説明  
    * **出題意図**: この問題がなぜ重要かの説明  
    * **根拠**: ノートからの引用箇所  
    * 「次の問題へ」または「結果を見る」ボタン  
* **共有管理モーダル**  
  * **目的**: 選択中のノートを他のユーザーと共有する。  
  * **コンポーネント**:  
    * 共有したい相手のメールアドレス入力フィールド  
    * 「追加」ボタン  
    * 現在共有中のユーザーリスト（削除ボタン付き）  
    * 「保存」ボタン

## **4\. データベース設計 (DynamoDB)**

### **4.1. テーブル定義**

共有機能を実現するため、Notesテーブルに共有情報を追加する。

| テーブル名 | パーティションキー(PK) | ソートキー(SK) | 主な属性 | 概要 |
| :---- | :---- | :---- | :---- | :---- |
| **Users** | userId (String) | \- | email, name, createdAt | ユーザー情報 |
| **Notes** | userId (String) | noteId (String) | title, sourceType, s3Path, **sharedWith (String Set)**, createdAt | ユーザーが入力したノート情報。sharedWithに共有相手のuserIdを格納。 |
| **Quizzes** | quizId (String) | \- | noteId, question, choices, answer, explanation, tags | 生成されたクイズの内容 |
| **Histories** | userId (String) | timestamp (Number) | quizId, isCorrect, userAnswer | ユーザーの解答履歴 |

## **5\. API設計 (主要エンドポイント)**

リアルタイム同期のためのGraphQL APIを追加する。

| API種別 | メソッド/オペレーション | エンドポイント/クエリ | 認証 | 主な役割 |
| :---- | :---- | :---- | :---- | :---- |
| **REST** | POST | /register, /login | 不要 | ユーザー登録・ログイン |
|  | POST, GET | /notes | Cognito | ノートの登録、一覧取得 |
|  | POST, GET | /quizzes, /histories | Cognito | クイズ生成、履歴関連 |
|  | POST | /chats | Cognito | AI教師との対話 |
| **GraphQL** | **Subscription** | onUpdateNote | Cognito | **ノートが共有・編集された際のリアルタイム更新を購読** |
|  | **Mutation** | shareNote | Cognito | **ノートを他のユーザーと共有する** |
|  | **Query** | getSharedNotes | Cognito | **自分に共有されているノート一覧を取得する** |

## **6\. 非機能要件設計**

| 項目 | 設計・実装方針 |
| :---- | :---- |
| **ユーザビリティ** | フロントエンドはコンポーネントベースで設計し、一貫性のあるUIを提供。ローディング中やエラー発生時のフィードバックを明確にする。 |
| **パフォーマンス** | クイズ生成など時間のかかる処理は非同期で実行。フロントエンドは体感速度を向上させるため、楽観的UI更新を検討。CloudFrontを利用し静的コンテンツを高速配信。 |
| **セキュリティ** | Cognitoで認証・認可を管理。API GatewayはJWTトークンで保護。S3へのファイルアクセスは署名付きURLを発行し、アクセスを一時的なものに限定する。 |
| **拡張性・保守性** | 各Lambda関数は単一責任の原則に基づき、機能を分割。これにより、個別の機能改修やスケールが容易になる。 |
| **リアルタイム同期** | ノートの共有状態などは、AWS AppSyncのSubscriptionを用いてリアルタイムに複数端末間で同期させる。 |
| **オフライン対応** | Service Workerを用いて、一度読み込んだノートやクイズをキャッシュし、オフラインでも閲覧・解答できるようにする。解答結果はローカル（IndexedDB）に保存し、オンライン復帰時にサーバーと同期する。 |

